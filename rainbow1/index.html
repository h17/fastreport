<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>The Rainbow Method Part I. Find an Ordinal Encoding | Your Data Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="The Rainbow Method Part I. Find an Ordinal Encoding" />
<meta name="author" content="Anna Arakelyan, Dmytro Karabash" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Data Science and Management" />
<meta property="og:description" content="Data Science and Management" />
<link rel="canonical" href="https://yourdatablog.com/rainbow1/" />
<meta property="og:url" content="https://yourdatablog.com/rainbow1/" />
<meta property="og:site_name" content="Your Data Blog" />
<meta property="og:image" content="https://yourdatablog.com/images/rainbow1.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-26T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Anna Arakelyan, Dmytro Karabash"},"description":"Data Science and Management","@type":"BlogPosting","url":"https://yourdatablog.com/rainbow1/","headline":"The Rainbow Method Part I. Find an Ordinal Encoding","dateModified":"2022-04-26T00:00:00-05:00","datePublished":"2022-04-26T00:00:00-05:00","image":"https://yourdatablog.com/images/rainbow1.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://yourdatablog.com/rainbow1/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://yourdatablog.com/feed.xml" title="Your Data Blog" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>The Rainbow Method Part I. Find an Ordinal Encoding | Your Data Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="The Rainbow Method Part I. Find an Ordinal Encoding" />
<meta name="author" content="Anna Arakelyan, Dmytro Karabash" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Data Science and Management" />
<meta property="og:description" content="Data Science and Management" />
<link rel="canonical" href="https://yourdatablog.com/rainbow1/" />
<meta property="og:url" content="https://yourdatablog.com/rainbow1/" />
<meta property="og:site_name" content="Your Data Blog" />
<meta property="og:image" content="https://yourdatablog.com/images/rainbow1.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-26T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Anna Arakelyan, Dmytro Karabash"},"description":"Data Science and Management","@type":"BlogPosting","url":"https://yourdatablog.com/rainbow1/","headline":"The Rainbow Method Part I. Find an Ordinal Encoding","dateModified":"2022-04-26T00:00:00-05:00","datePublished":"2022-04-26T00:00:00-05:00","image":"https://yourdatablog.com/images/rainbow1.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://yourdatablog.com/rainbow1/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://yourdatablog.com/feed.xml" title="Your Data Blog" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script type="text/javascript">
require.config({
  paths: {
    jquery: 'https://code.jquery.com/jquery-3.5.0.min',
    plotly: 'https://cdn.plot.ly/plotly-latest.min'
  },

  shim: {
    plotly: {
      deps: ['jquery'],
      exports: 'plotly'
    }
  }
});
</script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Your Data Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Us</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">The Rainbow Method Part I. Find an Ordinal Encoding</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-04-26T00:00:00-05:00" itemprop="datePublished">
        Apr 26, 2022
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Anna Arakelyan, Dmytro Karabash</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      20 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#data science">data science</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#categorical">categorical</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#encoding">encoding</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#one hot">one hot</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/h17/fastreport/tree/master/_notebooks/2022-04-26-Rainbow1.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/h17/fastreport/master?filepath=_notebooks%2F2022-04-26-Rainbow1.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/h17/fastreport/blob/master/_notebooks/2022-04-26-Rainbow1.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-04-26-Rainbow1.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/../images/rainbow1.jpg" alt="rainbow1" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Imagine that you have 2000 features and you need to make the best predictive model. Best in terms of complexity, interpretation, compliance, and, last but not least, performance. Such a case is familiar to anyone who worked with a large set of categorical variables and who employed the popular One-hot encoding method. Sparse data sets usually don't work well with highly efficient tree-based algorithms such as Random Forest or Gradient Boosting.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instead, we recommend finding an ordinal encoding even when there is no obvious order in categories. We introduce the Rainbow method - a set of techniques for identifying a good ordinal encoding. We show that the Rainbow method has multiple advantages over the conventional One-hot when used with tree-based algorithms.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here are some benefits of Rainbow method compared to One-hot:</p>
<ol>
<li><p><strong>Resource Efficiency</strong></p>
<ul>
<li>Saves substantial modeling time</li>
<li>Saves storage</li>
<li>Notably reduces the computational complexity</li>
<li>Reduces or removes the need for “big data” tools such as distributed processing
<br /></li>
</ul>
</li>
<li><p><strong>Model Efficiency</strong></p>
<ul>
<li>Significantly reduces model dimensionality</li>
<li>Preserves data granularity</li>
<li>Prevents overfitting</li>
<li>Models reach peak performance with simpler hyperparameters</li>
<li>Naturally promotes feature selection</li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this series of articles we define the Rainbow method and discuss its implications from different angles. Part I below explains the method and provides various examples of its use. <a href="link">Part II</a> explores its empirical application to a real-world production model at MassMutual. <a href="link">Part III</a> provides the mathematical foundation for the method and shows how it helps to prevent overfitting.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Background">Background<a class="anchor-link" href="#Background"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Data scientists with different backgrounds might have varying favorite approaches to categorical variables encoding. The general consensus though is that:</p>
<ol>
<li>Categorical variables with a natural ordering should use encoding that respects that ordering, such as ordinal encoding;</li>
</ol>
<ol>
<li>Categorical variables without a natural ordering, i.e. <em>nominal</em> variables, should use some kind of nominal encoding, and One-hot is the commonly used method. </li>
</ol>
<p>While One-hot encoding is often employed reflexively, it can cause multiple issues. Depending on the number of categories, it can create huge dimensionality increase, multicollinearity, overfitting, and overall a very complex model. These implications contradict Occam's razor principle.</p>
<p>It is not often and it is not generally accepted when modelers apply ordinal encoding to a categorical variable with no inherent order. However, some modelers do it purely for modeling performance reasons. We decided to explore both theoretially and empirically whether such approach provides any advantages. We believe that encoding of categorical variables deserves a deeper look.</p>
<p>In fact, most of the categorical variables have <em>some</em> order. The two examples above - a perfect natural ordering and no natural ordering - are just the extreme cases. Many real categorical variables are somewhere in between. Thus, turning them into a numeric variable would be neither exactly fair nor exactly artificial. It would be some mix of the two.</p>
<p>Our main conclusion is that ordinal encoding is likely better than One-hot for <strong>any</strong> categorical variable, when used with tree-based algorithms. And the Rainbow method that we introduce below helps select an ordinal encoding that makes the best logical and empirical sense. The Rainbow method also aspires to support interpretability and compliance which are important secondary considerations.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Linear-vs-Tree-based-Models">Linear vs Tree-based Models<a class="anchor-link" href="#Linear-vs-Tree-based-Models"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Formal statistical science separates strictly between quantitative and categorical variables. Researchers apply different approaches to describe these variables and treat them differently in linear models such as Regression. Even when certain categorical variables have natural ordering, one should be very cautious about applying any quantitative methods to them.</p>
<p>For example, if the task is to build a linear model where one independent variable is <em>Education Level</em>, the standard approach is to encode it via One-hot. Alternatively, one could engineer a new quantitative feature <em>Years of Educaton</em> to replace the original variable, although in that case it would not be a perfectly equivalent replacement.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unlike linear models, tree-based models rely on variable ranks rather than exact values. So using ordinal encoding for <em>Education Level</em> is perfectly equivalent to One-hot. It would actually be an overkill to use One-hot for variables with clear natural ordering.</p>
<p>And the values assigned to categories won't even matter as long as the correct order is preserved. For example, Decision Trees, Random Forest, Gradient Boosting - these algorithms will output the same result if, say, the variable <em>Number of Children</em> is coded as</p>
<hr />
<p>0 = "0 Children" <br />
1 = "1 Child"<br />
2 = "2 Children"<br />
3 = "3 Children"<br />
4 = "4 or more Children"</p>
<hr />
<p>or as</p>
<hr />
<p>1 = "0 Children" <br />
2 = "1 Child"<br />
3 = "2 Children"<br />
4 = "3 Children"<br />
5 = "4 or more Children"</p>
<hr />
<p>or even as</p>
<hr />
<p>-100 = "0 Children" <br />
-85 = "1 Child"<br />
0 = "2 Children"<br />
10 = "3 Children"<br />
44 = "4 or more Children"</p>
<hr />
<p>The values themselves don't serve a quantitative function in these algorithms. It is the rank of the variable that matters, and a tree-based algorithm will use its magic to make the most appropriate splits to introduce new tree nodes.</p>
<p>Decision trees don't work well with a large number of binary variables. The splitting process is not efficient, especially when the fitting is heavily regularized or constrained. Because of that, even if we randomly order categories and make a single label encoded feature, it would still be likely better than One-hot. We prove this formally in <a href="link">Part III</a> and analyze the conditions and the edge cases.</p>
<p>Random Forest and Gradient Boosting are often picked among other algorithms due to better performance, so our method could prove handy in many cases. The application of our method to other algorithms such as Linear Regression or Logistic Regression is out of the scope of this article. We expect that this method of feature engineering may still be beneficial, but that is subject to additional investigation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Method">Method<a class="anchor-link" href="#Method"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Think of a clearly nominal categorical variable. One example is Color. Say, the labels are "Green", "Red", "Blue", "Violet", "Orange", "Yellow", "Indigo".</p>
<p>We would like to find an order in the labels, and such an order exists - a rainbow. So, instead of making seven One-hot features, you can simply create a single feature with encoding:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>0 = "Red" <br />
1 = "Orange" <br />
2 = "Yellow" <br />
3 = "Green" <br />
4 = "Blue" <br />
5 = "Indigo" <br />
6 = "Violet"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hence, we called the set of techniques to find an order in categories - the Rainbow method. We found it amazing that there exists a natural phenomenon that represents label encoding for a nominal variable!</p>
<p>Generalizing this logic, we suggest <strong>finding a rainbow</strong> for any categorical variable. Even if possible ordering is not obvious or if there doesn't seem to be one, we offer some techniques to find it. Often, some order in categories exists, but it is not visible to the modelers. As we show in <a href="link">Part II</a> and <a href="link">Part III</a>, if the data generating process indeed presumes <em>some</em> order in categories, utlizing it in the model will be substantially more efficient than splitting categories into One-hot features. Hence our motto:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>"When nature gives you a rainbow, take it..."</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>According to our findings, the more clearly defined category order, the higher benefits in terms of model performance for using ordinal encoding instead of One-hot. However, even in the complete absence of order, making and using random Rainbow is likely to result in the same model performance as One-hot while saving substantial dimensionality. This is why searching for a rainbow is a worthwhile pursuit.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>Is Color a nominal variable?</strong> <br /><br />
Some of the readers might argue that Color is clearly an ordinal variable, so there is no surprise that we found an ordinal encoding. <br /><br />
On the one hand, modelers from different scientific backgrounds may view same categorical variables differently and probably used to apply certain encoding methods reflexively. For example, I (Anna) studied Economics and Econometrics,  and I did not encounter any use case that could treat Color as quantitative. At the same time modelers that studied Physics or Math might have utilized wavelength in their modeling experience, and likely considered Color ordinal. If you represent the latter modelers, please take a minute and think of a different example of a clearly nominal variable. <br /><br />
On the other hand, whether the natural ordering exists or not does not change our message. In short, if the order exists - great! If it does not... well, we want you to find it!  We will provide more examples below and hope they can guide you on how to find a rainbow for your own example nominal variable.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Most nominal variables, at first glance, seem like they cannot be converted to a quantitative scale. This is where we suggest finding a rainbow. With color, the natural scale might be <em>hue</em>, but that's not the only option - there's also <em>brightness</em>, <em>saturation</em>, <em>temperature</em>, etc. We invite you to experiment with a few different Rainbows that might capture different nuances of the categorical quality.</p>
<p>You can actually make and use two or more Rainbows out of one categorical variable depending on the number of categories $K$ and the context.</p>
<blockquote><p>We don't recommend using more than $\log_2 {K}$ Rainbows, because we do not want to surpass the number of encodings in a <a href="https://www.sciencedirect.com/topics/computer-science/one-hot-encoding">Binary One-hot</a>.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Rainbow method is very simple and intuitively sensible. In many cases it is not even that important which Rainbow you choose (and by that we mean the color order); it would still be better than One-hot. The more natural orders are just likely to perform better than others and be easier to interpret.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Finding-a-Rainbow---Examples">Finding a Rainbow - Examples<a class="anchor-link" href="#Finding-a-Rainbow---Examples"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The statistical concept of level of measurement plays an important role in separating variables with natural ordering from the variables without it. While <strong>quantitative</strong> variables have a <em>ratio</em> scale, i.e. they have a meaningful 0, ordered values, and equal distances between values, <strong>categorical</strong> variables have either <em>interval</em>, <em>ordinal</em>, or <em>nominal</em> scales.
Let us illustrate our method for each of these types of categorical variables.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Interval</strong> variables have ordered values and equal distances between values, but the values themselves are not necessarily meaningful. For example, 0 does not indicate the absence of some quality. Common examples of interval variables are Likert scales: <br /></p>
<hr />
<p><em>How likely is the person to buy a smartphone?</em>
<br /><br />
1: "Very Unlikely" <br />
2: "Somewhat Unlikely"<br />
3: "Neither Likely Nor Unlikely"<br />
4: "Somewhat Likely"<br />
5: "Very Likely"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Without a doubt, interval variables intrinsically give us the best and most natural Rainbow. Most of the modelers would encode them numerically.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>1 = "Very Unlikely" <br />
2 = "Somewhat Unlikely"<br />
3 = "Neither Likely Nor Unlikely"<br />
4 = "Somewhat Likely"<br />
5 = "Very Likely"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Notation:we use colon sign to denote raw category names, and we use equals sign to denote assignment of numeric values to categories.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Ordinal</strong> variables have ordered meaningless values, and the distances between values are neither equal nor explainable. <br /></p>
<hr />
<p><em>What is the highest level of Education completed by the person?</em>
<br /><br />
A: "Bachelor's Degree" <br />
B: "Master's Degree" <br />
C: "Doctoral Degree" <br />
D: "Associate Degree" <br />
E: "High School"<br />
F: "No High School" <br /></p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similar to interval variables, ordinal variables have an inherent natural Rainbow. Sometimes the categories for an ordinal variable are not listed according to the correct order, and that might steer us away from seeing an immediate Rainbow. With some attention to the variables, we could reorder categories and then use this updated variable as a quantitative feature.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>1 = "No High School"<br />
2 = "High School" <br />
3 = "Associate Degree" <br />
4 = "Bachelor's Degree" <br />
5 = "Master's Degree" <br />
6 = "Doctoral Degree" <br /></p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So far, most modelers would organically use the best Rainbow. The more complicated question is how to treat nominal variables.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Nominal</strong> variables have no obvious order between categories. The intricacy is that for machine learning modeling goals, we could be more flexible with variables and engineer features even if they make little sense from statistical standpoint. In this way, using Rainbow method, we can turn a nominal variable into a quantitative one.</p>
<p>The main idea behind <strong>finding a rainbow</strong> is the utilization of either human intelligence or automated tools. For relatively small projects where you can directly examine every categorical variable, we recommend putting direct human intelligence to such selection. For large scale projects with many complex data sets, we offer some automated tools to generate viable quantitative scales.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Manual-Rainbow-Selection">Manual Rainbow Selection<a class="anchor-link" href="#Manual-Rainbow-Selection"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's look at some examples of manual subjective Rainbow selection. The trick is to find a quantitative scale by either using some concrete related attribute or to construct that scale from a possibly abstract concept.</p>
<p>In  our classical example, for a nominal variable <em>Color</em>, the Hue attribute suggests a possible scale. So the nominal categories</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>A: "Red" <br />
B: "Blue" <br />
C: "Green" <br />
D: "Yellow" <br /></p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>can be replaced by the newly engineered Rainbow feature:</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>1 = "Blue" <br />
2 = "Green"<br />
3 = "Yellow"<br />
4 = "Red"<br /></p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the <em>Vehicle Type</em> variable below,</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p><em>Vehicle Type</em> <br /><br />
C: "Compact Car"<br />
F: "Full-size Car"<br />
L: "Luxury Car"<br />
M: "Mid-Size Car"<br />
P: "Pickup Truck"<br />
S: "Sports Car"<br />
U: "SUV"<br />
V: "Van"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>we can think of dozens of characteristics to make a Rainbow - vehicle size, capacity, price category, average speed, fuel economy, costs of ownership, motor features, etc. Which one (or a few) to pick? The choice depends on the context of the model. Think how can this feature help predict your outcome variable. You can try a few possible Rainbows and pick the best in terms of model performance and interpretation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Consider another variable:</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Marital Status</em> <br /><br />
A: "Married" <br />
B: "Single" <br />
C: "Inferred Married" <br />
D: "Inferred Single" <br /></p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is where we can get a bit creative. If we think about Single and Married as two ends of a spectrum, then Inferred Single could be between the two ends, closer to Single, while Inferred Married would be between the two ends, closer to Married. That would make sense because Inferred holds a certain degree of uncertainty. Thus, the following order would be reasonable:</p>
<hr />
<p>1 = "Single" <br />
2 = "Inferred Single" <br />
3 = "Inferred Married" <br />
4 = "Married"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In case there are any missing values, a new category "Unknown", fits exactly in the middle between Single and Married as there is no reason to prefer one end to the other. So the modified scale could look like this:</p>
<hr />
<p>1 = "Single" <br />
2 = "Inferred Single" <br />
3 = "Unknown" <br />
4 = "Inferred Married" <br />
5 = "Married"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Another example:</p>
<hr />
<p><em>Occupation</em> <br /><br />
1: "Professional/Technical"<br />
2: "Administration/Managerial"<br />
3: "Sales/Service"<br />
4: "Clerical/White Collar"<br />
5: "Craftsman/Blue Collar"<br />
6: "Student"<br />
7: "Homemaker"<br />
8: "Retired"<br />
9: "Farmer"<br />
A: "Military"<br />
B: "Religious"<br />
C: "Self Employed"<br />
D: "Other"<br /></p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finding a rainbow in this example might be harder, but here are a few ways to do it: we could order occupations by average annual salary, by their prevalence in the geographic area of interest, or by information from some other dataset. That might involve calling a Census API or some other data source, and might be complicated by the fact that these values are not static, but these are still viable solutions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Automated-Rainbow-Selection">Automated Rainbow Selection<a class="anchor-link" href="#Automated-Rainbow-Selection"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What if there is no good related attribute? In some situations, we cannot find a logical order for the Rainbow because the variable itself is not interpretable. Alternatively, what if we have very large data and no resources to manually examine each variable? This next technique is handy for such cases.</p>
<p>Let's look at a black box column made by a third party:</p>
<hr />
<p><em>Financial Cluster of the Household</em> <br /><br />
 1: "Market Watchers" <br />
 2: "Conservative Wealth" <br />
 3: "Specific Savers" <br />
 4: "Tried and True" <br />
 5: "Trendy Inclinations" <br />
 6: "Current Consumers" <br />
 7: "Rural Trust" <br />
 8: "City Spotlight" <br />
 9: "Career Conscious" <br />
10: "Digital Financiers" <br />
11: "Financial Futures" <br />
12: "Stable Influentials" <br />
13: "Conservatively Rural"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this example, we have no clear idea of what each category entails. And, thus, we have no intuition on how to order these categories. What to do in such situation? We recommend creating an artificial Rainbow by looking at how each category is related to the target variable.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The simplest solution is to place categories in the order of correlation with the target variable. So the category with the highest value of correlation with the dependent variable would acquire numeric code 1, and the category with the lowest correlation would acquire numeric code 13. So our Rainbow in this case would mean the relationship between the financial cluster and the target variable. This method would work for both classification and regression models as it can be applied to a discrete and a continuous target variable.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Alternatively, you can construct your Rainbows by merely utilizing certain statistical qualities of the categorical variable and the target variable.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For instance, in the case of a binary target variable, we could look at the proportion of ones given each of the categories. Suppose, among Market Watchers percent of positive targets is 0.67, while for Conservative Wealth it is 0.45. In that case, Market Watchers will be ordered higher than Conservative Wealth (or lower, if the target percent scale is ascending). In other words, this Rainbow would reflect the prevalence of positive targets inside each category.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One reasonable concern with these automated methods is a potential overfit. When we use posterior knowledge of correlation or target percent that relates independent variable with the dependent variable, this can likely cause data leakage. To tackle this problem, we recommend learning Rainbow orders on a random holdout sample.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Rainbow-Preserves-Full-Data-Signal">Rainbow Preserves Full Data Signal<a class="anchor-link" href="#Rainbow-Preserves-Full-Data-Signal"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this section we briefly show that Rainbow ordinal encoding is perfectly equivalent to One-hot when used on decision trees. In other words, that full data signal is preserved.</p>
<p>We also show below that, if the selected Rainbow (order of categories) agrees with the "true" one, i.e. with the data generating process - the resulting model will be strictly better than One-hot model. To measure model quality, we will look at number of splits in a tree. Less splits means simpler, more efficient and less overfit model.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us zoom in for a minute on a classical Rainbow example with just 4 values:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p><em>Color</em> <br /><br />
0 = "Red" <br />
1 = "Yellow" <br />
2 = "Green" <br />
3 = "Blue"</p>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the case of One-hot, we would create 4 features: <br /></p>
<p><em>Color_Red</em> = 1 if <em>Color</em> = 0 and 0 otherwise,<br />
<em>Color_Yellow</em> = 1 if <em>Color</em> = 1 and 0 otherwise,<br />
<em>Color_Green</em> = 1 if <em>Color</em> = 2 and 0 otherwise,<br />
<em>Color_Blue</em> = 1 if <em>Color</em> = 3 and 0 otherwise.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the case of Rainbow, we would just use <em>Color</em> by itself.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's compare the possible models made using these two methods: 4 features vs 1 feature. For simplicity's sake, let's build a single decision tree. Consider a few scenarios of the data generating process.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Scenario-1">Scenario 1<a class="anchor-link" href="#Scenario-1"> </a></h3><p>Assume all the categories are wildly different, and each one introduces a substantial gain to the model. That means each One-hot feature is indeed critical - the model should separate between all 4 groups created by One-hot.</p>
<p>In that case, an algorithm such as <em>XGBoost</em> will just make the splits between all the values which is perfectly equivalent to One-hot. There are exactly three splits in both models. So the same exact result is achieved with just one feature instead of four.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Figure 1</p>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/img-anna/R01.png" alt="" style="max-width: 600/px" />
    
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One can clearly see that this example is easily generalized to One-hot with <strong>any</strong> number of categories. Also, note that the order of the categories in Rainbow does not matter as splits will be made between <strong>all</strong> categories. In practice, $(K-1)$ splits will be sufficient for both methods to separate between $K$ categories.</p>
<p>Figure 2</p>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/img-anna/R02.png" alt="" style="max-width: 600px" />
    
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The main takeaway is that not a bit of data signal is lost if one switches from One-hot to Rainbow. In addition, depending on the number of categories, a substantial dimensionality reduction happens which saves time, storage, and reduces model complexity.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sometimes, modeleres try to beat One-hot's dimensionality issue by combining categories into some logical groups, and turn these into binary variables. The shortcoming of this method is the loss of data granularity. Note that by using the Rainbow method we do not lose any level of granularity.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Scenario-2">Scenario 2<a class="anchor-link" href="#Scenario-2"> </a></h3><p>Let's look at a less favorable scenario for Rainbow, where the chosen order does not agree with the "true" one. Let's say, the data generating process separates between the group of {Red, Green} and {Yellow, Blue}.</p>
<p>In that case, the algorithm will make all the necessary splits - three for Rainbow and two or three for One-hot, depending on the order of One-hot features picked up by the tree.</p>
<p>Figure 3</p>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/img-anna/R03.png" alt="" style="max-width: 650px" />
    
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Even in this least favorable scenario, no data information is lost when choosing Rainbow method, because a tree with a maximum of $(K-1)$ splits will reflect any data generating process.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Scenario-3">Scenario 3<a class="anchor-link" href="#Scenario-3"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, if the data generating process is actually in agreement with the Rainbow order, then the Rainbow method would be superior to One-hot. Not only will it not lose any data signal, but it will also substantially reduce complexity, decrease dimensionality, and help avoid overfitting.</p>
<p>Suppose the true model pattern only separates between {Red, Yellow} and {Green, Blue}. In that case, Rainbow has a clear advantage as it exploits these groupings while One-hot does not. While One-hot model must make two or three splits, the Rainbow model only needs one.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Figure 4</p>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/img-anna/R04.png" alt="" style="max-width: 650px" />
    
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The scenarios above show that by substituting One-hot with Rainbow, we save dimensionality without any information loss. If the Rainbow order is even <em>somewhat</em> meaningful, the algorithm would capture similarity between adjacent values by making a smart decision about the number and location of splits. Thus, we will receive a simpler and better model.</p>
<p>As a side result, the Rainbow method suggests the right language for better and more succinct feature selection. Instead of long and tedious process that runs through 2000 features, where you need to do some serious compliance to justify the selection, you would take advantage of much smaller number of very dense features that have natural explanation. That reduces time, storage, and documentation greatly.</p>
<p>In <a href="link">Part II</a> we show the advantages of the Rainbow method over the One-hot using an empirical example from a real data science project at MassMutual. In <a href="link">Part III</a> we prove mathematically that the Rainbow method outperforms One-hot in the worst, the average, and the best scenarios.</p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/rainbow1/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Data Science and Management</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
